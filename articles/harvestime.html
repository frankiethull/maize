<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>harvestime • maize</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="harvestime_files/libs/quarto-html/popper.min.js"></script><script src="harvestime_files/libs/quarto-html/tippy.umd.min.js"></script><link href="harvestime_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="harvestime_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="harvestime">
<meta property="og:image" content="https://frankiethull.github.io/maize/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">maize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.95</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ensembling_weak_learners.html">ensembling weak learners in maize</a></li>
    <li><a class="dropdown-item" href="../articles/extending_kernlab_support.html">new engines in maize</a></li>
    <li><a class="dropdown-item" href="../articles/glass-gem.html">glass-gem</a></li>
    <li><a class="dropdown-item" href="../articles/harvestime.html">harvestime</a></li>
    <li><a class="dropdown-item" href="../articles/perchance.html">perchance</a></li>
    <li><a class="dropdown-item" href="../articles/pre-processors-in-maize.html">pre-processors in maize</a></li>
    <li><a class="dropdown-item" href="../articles/SVMs.html">SVMs</a></li>
    <li><a class="dropdown-item" href="../articles/two-class-post-processing.html">two-class-post-processing</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>harvestime</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime" class="external-link">modeltime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kernlab'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     alpha</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:modeltime':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     error</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://frankiethull.github.io/maize/">maize</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'maize'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:parsnip':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     check_args</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="maize-for-time-series">{maize} for time series<a class="anchor" aria-label="anchor" href="#maize-for-time-series"></a>
</h2>
<p>{maize} continues into the realm of novel ML techniques. In this release, we are looking at extending SVMs into time series. How does this work in maize? In one of two ways: enhancing ARIMAs or via a recursive framework.</p>
<section class="level4"><h4 id="arima-svm-errors">ARIMA + SVM Errors<a class="anchor" aria-label="anchor" href="#arima-svm-errors"></a>
</h4>
<p>Based on the notorious <strong>“Boosted” ARIMA</strong> implementation in time series machine learning. maize swaps the XGBoost algorithm with an SVM with Laplacian Kernel.</p>
<p>Within this implementation, both <code>autoARIMA</code> and <code>ARIMA</code> models are both supported, with or without external regressors. This framework leverages two model fits! First, an ARIMA model to fit a time series regression for the outcome variable. Next, an SVM regression is fit on the model residuals.</p>
<p><em>this code follows along with {modeltime}’s getting <a href="https://business-science.github.io/modeltime/articles/getting-started-with-modeltime.html" class="external-link">started</a>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m750</span> <span class="op">&lt;-</span> <span class="va">m4_monthly</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"M750"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m750</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/plot_time_series.html" class="external-link">plot_time_series</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span>, .interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="harvestime_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Splitting our data and fitting two models, a regular AutoARIMA, and the AutoARIMA + SVM Laplace Errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Split Data 80/20</span></span>
<span><span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_time_split</a></span><span class="op">(</span><span class="va">m750</span>, prop <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># benchmark model:</span></span>
<span><span class="va">model_fit_arima_no_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/arima_reg.html" class="external-link">arima_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"auto_arima"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">date</span>, data <span class="op">=</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; frequency = 12 observations per 1 year</span></span>
<span></span>
<span><span class="co"># arima SVM errors:</span></span>
<span><span class="va">model_fit_arima_svm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arima_svm_laplace.html">arima_svm_laplace</a></span><span class="op">(</span></span>
<span>    cost          <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    margin        <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>    laplace_sigma <span class="op">=</span> <span class="fl">.2</span></span>
<span>     <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"auto_arima_svm_laplace"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; frequency = 12 observations per 1 year</span></span>
<span></span>
<span><span class="va">model_fit_arima_svm</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ARIMA(0,1,1)(0,1,1)[12] w/ SVM Errors</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Model 1: Auto ARIMA</span></span>
<span><span class="co">#&gt; Series: outcome </span></span>
<span><span class="co">#&gt; ARIMA(0,1,1)(0,1,1)[12] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;           ma1     sma1</span></span>
<span><span class="co">#&gt;       -0.3405  -0.4781</span></span>
<span><span class="co">#&gt; s.e.   0.0652   0.0628</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sigma^2 = 25114:  log likelihood = -1699.55</span></span>
<span><span class="co">#&gt; AIC=3405.1   AICc=3405.19   BIC=3415.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Model 2: SVM Errors</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Support Vector Machine object of class "ksvm" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SV type: eps-svr  (regression) </span></span>
<span><span class="co">#&gt;  parameter : epsilon = 0.1  cost C = 10 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Laplace kernel function. </span></span>
<span><span class="co">#&gt;  Hyperparameter : sigma =  0.2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Support Vectors : 244 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Objective Function Value : -1115 </span></span>
<span><span class="co">#&gt; Training error : 0.574759</span></span></code></pre></div>
</div>
<p>parsnip minimal output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_fit_arima_svm</span>, <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 1</span></span>
<span><span class="co">#&gt;    .pred</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 10395.</span></span>
<span><span class="co">#&gt; 2 10613.</span></span>
<span><span class="co">#&gt; 3 10608.</span></span>
<span><span class="co">#&gt; 4 10779.</span></span>
<span><span class="co">#&gt; 5 10744.</span></span>
<span><span class="co">#&gt; 6 10761.</span></span></code></pre></div>
</div>
<p>modeltime calibration and autoplots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>    <span class="va">model_fit_arima_no_svm</span>,</span>
<span>    <span class="va">model_fit_arima_svm</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">calibration_tbl</span> <span class="op">&lt;-</span> <span class="va">models_tbl</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_calibrate.html" class="external-link">modeltime_calibrate</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">calibration_tbl</span><span class="op">$</span><span class="va">.model_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AutoARIMA"</span>, <span class="st">"AutoARIMA + SVM Errors"</span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level5"><h5 id="calibrated-autoarima-vs--autoarima-w-svm-laplacian-kernel-errors-predictions">Calibrated AutoARIMA vs. AutoARIMA w/ ‘SVM Laplacian Kernel’ Errors predictions:<a class="anchor" aria-label="anchor" href="#calibrated-autoarima-vs--autoarima-w-svm-laplacian-kernel-errors-predictions"></a>
</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calibration_tbl</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_forecast.html" class="external-link">modeltime_forecast</a></span><span class="op">(</span></span>
<span>        new_data    <span class="op">=</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>,</span>
<span>        actual_data <span class="op">=</span> <span class="va">m750</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>      .legend_max_width <span class="op">=</span> <span class="fl">25</span>, <span class="co"># For mobile screens</span></span>
<span>      .interactive      <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning</span></span>
<span><span class="co">#&gt; -Inf</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="harvestime_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="level4"><h4 id="recursive-svms">Recursive SVMs<a class="anchor" aria-label="anchor" href="#recursive-svms"></a>
</h4>
<p>Recursive SVMs are a bit different than the ARIMA method mentioned above. This framework does not depend on a traditional statistical method such as ARIMA, but revolves around lagged features of the outcome variable as a predictor. This deviates from the <code>parsnip</code> base models and leans towards <code>modeltime</code>. In <code>maize</code>, the goal is to have a simple lagged interface for SVMs, not typically supported elsewhere.</p>
<p>This autoregressive machine learning technique can be read about more in the {modeltime} documentation <a href="https://business-science.github.io/modeltime/articles/recursive-forecasting.html" class="external-link">here</a>. <em>Note there are many methods for lagged &amp; rolling transformations, below we will showcase a simple lag transformer. {maize} does not currently have recursive() bindings but showcases how to use maize with modeltime’s recursive() below!</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co"># splits </span></span>
<span><span class="va">splits</span>   <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_time_split</a></span><span class="op">(</span><span class="va">m750</span>, prop <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">training</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> </span>
<span><span class="va">testing</span>  <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># horizon and number of lags:</span></span>
<span><span class="va">horizon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">testing</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lag_transformer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">timetk</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/timetk/man/tk_augment_lags.html" class="external-link">tk_augment_lags</a></span><span class="op">(</span><span class="va">value</span>, .lags <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">horizon</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extended</span> <span class="op">&lt;-</span> <span class="va">m750</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">timetk</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">future_frame</a></span><span class="op">(</span></span>
<span>    .length_out <span class="op">=</span> <span class="va">horizon</span>,</span>
<span>    .bind_data  <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; .date_var is missing. Using: date</span></span>
<span></span>
<span><span class="va">m4_lags</span> <span class="op">&lt;-</span> <span class="va">extended</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">lag_transformer</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">m4_lags</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_data</span> <span class="op">&lt;-</span> <span class="va">m4_lags</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_fit_recursive_svm_laplace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svm_laplace.html">svm_laplace</a></span><span class="op">(</span></span>
<span>  mode <span class="op">=</span> <span class="st">"regression"</span>,</span>
<span>  cost <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  margin <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>  laplace_sigma <span class="op">=</span> <span class="fl">.2</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"kernlab"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>    <span class="va">value</span> <span class="op">~</span> <span class="va">.</span></span>
<span>    <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span>    <span class="op">-</span> <span class="va">date</span>,</span>
<span>    data <span class="op">=</span> <span class="va">train_data</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">modeltime</span><span class="fu">::</span><span class="fu"><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive</a></span><span class="op">(</span></span>
<span>    transform  <span class="op">=</span> <span class="va">lag_transformer</span>,</span>
<span>    train_tail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">horizon</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="va">model_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>  <span class="va">model_fit_recursive_svm_laplace</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">model_tbl</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="co"># Forecast using future data</span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_forecast.html" class="external-link">modeltime_forecast</a></span><span class="op">(</span></span>
<span>    new_data    <span class="op">=</span> <span class="va">future_data</span>,</span>
<span>    actual_data <span class="op">=</span> <span class="va">m750</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="co"># Visualize the forecast</span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>    .interactive        <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    .conf_interval_show <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Adding missing grouping variables: `id`</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="harvestime_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Frank Hull.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
